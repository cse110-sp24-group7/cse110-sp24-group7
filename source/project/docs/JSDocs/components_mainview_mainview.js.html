<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: components/mainview/mainview.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: components/mainview/mainview.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/* eslint-disable no-undef */

const filters = {
	startTime: "",
	endTime: "",
	labels: [],
	priorities: [],
	exclusive: false
};

let labelColorMap = new Map();

/**
 * Adds tasks to the task containers.
 * @param {Task[]} tasks - an array of task objects.
 */
function tasksRendererCallback(tasks) {
	// Clear all existing task entries first
	document.querySelectorAll(".task-container").forEach((container) => {
		container.innerHTML = ""; // Clears all child elements
	});

	// Add new tasks
	tasks.forEach((task) => {
		// Create elements for the task entry
		const taskPv = document.createElement("div");
		taskPv.classList.add("task-pv");

		const taskName = document.createElement("h2");
		taskName.textContent = task.task_name;
		taskPv.appendChild(taskName);

		const taskContent = document.createElement("p");
		taskContent.textContent = task.task_content;
		taskPv.appendChild(taskContent);

		const taskDueDate = document.createElement("p");
		taskDueDate.textContent = `Due: ${task.due_date}`;
		taskPv.appendChild(taskDueDate);

		const taskPriority = document.createElement("p");
		taskPriority.textContent = `Priority: ${task.priority}`;
		taskPv.appendChild(taskPriority);

		const taskExpectedTime = document.createElement("p");
		taskExpectedTime.textContent = `Expected Time: ${task.expected_time}`;
		taskPv.appendChild(taskExpectedTime);

		// for each label, create a small colored box representing that label
		if (task.labels.length > 0) {
			const taskLabels = document.createElement("div");
			taskLabels.classList.add("label-container");
			task.labels.forEach((label) => {
				const labelDiv = document.createElement("div");
				labelDiv.classList.add("label");
				labelDiv.style.backgroundColor = labelColorMap.get(label);
				taskLabels.appendChild(labelDiv);
			});
			taskPv.appendChild(taskLabels);
		}

		// Find the appropriate day container based on the task's due date
		// Assuming due_date is in 'YYYY-MM-DD' format and you need to map it to a specific day
		const dueDate = new Date(task.due_date);
		const dayIndex = dueDate.getDay(); // Sunday - Saturday : 0 - 6
		const dayContainer = document.querySelector(
			`.day${dayIndex + 1} .task-container`
		);

		if (dayContainer) {
			dayContainer.appendChild(taskPv);
		}
	});
}

/**
 * Adds journal entries to the journal containers.
 * @param {Entry[]} entries - an array of journal entry objects.
 */
function entriesRendererCallback(entries) {
	// Clear all existing journal entries first
	document.querySelectorAll(".journal-container").forEach((container) => {
		container.innerHTML = ""; // Clears all child elements
	});

	entries.forEach((entry) => {
		// Create elements for the journal entry
		const journalPv = document.createElement("div");
		journalPv.classList.add("journal-pv");

		const journalTitle = document.createElement("h2");
		journalTitle.textContent = entry.entry_title;
		journalPv.appendChild(journalTitle);

		const journalDesc = document.createElement("p");
		journalDesc.textContent = entry.entry_content;
		journalPv.appendChild(journalDesc);

		if (entry.labels.length > 0) {
			const journalLabels = document.createElement("div");
			journalLabels.classList.add("label-container");

			entry.labels.forEach((label) => {
				const journalDiv = document.createElement("div");
				journalDiv.classList.add("label");
				journalDiv.style.backgroundColor = labelColorMap.get(label);
				journalLabels.appendChild(journalDiv);
			});
			journalPv.appendChild(journalLabels);
		}

		// Find the appropriate day container based on the entry's creation date
		// Assuming creation_date is in 'YYYY-MM-DD' format and you need to map it to a specific day
		const creationDate = new Date(entry.creation_date);
		const dayIndex = creationDate.getDay(); // Sunday - Saturday : 0 - 6
		const dayContainer = document.querySelector(
			`.day${dayIndex + 1} .journal-container`
		);

		if (dayContainer) {
			dayContainer.appendChild(journalPv);
		}
	});
}

/**
 * Loads the dates on the weekly view
 * @param {number} weekOffset = index value relative to today's current week
 */
function setWeeklyView(weekOffset) {
	const daysOfWeek = ["sun", "mon", "tue", "wed", "thu", "fri", "sat"];
	const today = new Date();
	today.setDate(today.getDate() + weekOffset * 7);

	const currentDay = today.getDay();
	const currentDate = today.getDate();

	const startDate = new Date(today);
	startDate.setDate(startDate.getDate() - currentDay);
	startDate.setHours(0, 0, 0, 0);

	const endDate = new Date(startDate);
	endDate.setDate(endDate.getDate() + 6); // Move to Saturday
	endDate.setHours(23, 59, 59, 999); // Set to Saturday 23:59

	filters.startTime = startDate
		.toISOString()
		.substring(
			0,
			startDate
				.toISOString()
				.indexOf(":", startDate.toISOString().indexOf(":") + 1)
		);
	filters.endTime = endDate
		.toISOString()
		.substring(
			0,
			endDate
				.toISOString()
				.indexOf(":", endDate.toISOString().indexOf(":") + 1)
		);

	const monthNames = [
		"JANUARY",
		"FEBRUARY",
		"MARCH",
		"APRIL",
		"MAY",
		"JUNE",
		"JULY",
		"AUGUST",
		"SEPTEMBER",
		"OCTOBER",
		"NOVEMBER",
		"DECEMBER"
	];
	const currentMonthElement = document.getElementById("current-month");
	currentMonthElement.textContent = monthNames[today.getMonth()];

	daysOfWeek.forEach((day, index) => {
		const dayColumn = document.querySelector(`.day${index + 1}`);
		const dateElement = dayColumn.querySelector(".day-date");
		const dayDate = new Date(startDate);
		dayDate.setDate(startDate.getDate() + index);
		const dayNumber = dayDate.getDate();
		dateElement.textContent = dayNumber;

		if (dayNumber === currentDate &amp;&amp; weekOffset === 0) {
			dateElement.classList.add("today");
		} else {
			dateElement.classList.remove("today");
		}
	});

	updateMainview();
}

function updateMainview() {
	// First update color map, then update tasks and entries.
	window.api.getLabelColorMap((map) => {
		labelColorMap = map;
		window.api.getFilteredTasks(filters, (tasks) => {
			localStorage.setItem("tasks", JSON.stringify(tasks));
			tasksRendererCallback(tasks);
		});
		window.api.getFilteredEntries(filters, (entries) => {
			localStorage.setItem("journalData", JSON.stringify(entries));
			entriesRendererCallback(entries);
		});
	});
}

document.addEventListener("DOMContentLoaded", async () => {
	let currentWeekOffset = 0;
	await window.path.getUserData().then((userData) => {
		console.log("Renderer access userdata: " + userData);
		window.api.connect(userData, () => {
			window.api.init(() => {
				console.log("Renderer init table.");
				setWeeklyView(currentWeekOffset); // Load this week's dates
			});
		});
	});

	document.addEventListener("storageUpdate", () => {
		updateMainview();
	});

	// creates the popup when the add task button is clicked
	document.querySelectorAll(".add-task").forEach((button) => {
		button.addEventListener("click", () => {
			const popup = document.createElement("task-popup");
			document.body.appendChild(popup);
		});
	});

	// creates the popup when the add journal entry button is clicked
	document.querySelectorAll(".add-journal").forEach((button) => {
		button.addEventListener("click", () => {
			const popup = document.createElement("journal-popup");
			document.body.appendChild(popup);
		});
	});

	// Display correct week when clicking arrows
	document.getElementById("prev-week").addEventListener("click", () => {
		currentWeekOffset -= 1;
		setWeeklyView(currentWeekOffset);
	});

	document.getElementById("next-week").addEventListener("click", () => {
		currentWeekOffset += 1;
		setWeeklyView(currentWeekOffset);
	});

	// Display the current week when clicking "Today" Button
	document.getElementById("today-button").addEventListener("click", () => {
		currentWeekOffset = 0;
		setWeeklyView(currentWeekOffset);
	});

	// updateMainview();
});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Filter.html">Filter</a></li><li><a href="JournalPopup.html">JournalPopup</a></li><li><a href="TaskPopup.html">TaskPopup</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addEntries">addEntries</a></li><li><a href="global.html#addEntry">addEntry</a></li><li><a href="global.html#addLabel">addLabel</a></li><li><a href="global.html#addLabels">addLabels</a></li><li><a href="global.html#addNewLabelInput">addNewLabelInput</a></li><li><a href="global.html#addPriorityListeners">addPriorityListeners</a></li><li><a href="global.html#addResetListener">addResetListener</a></li><li><a href="global.html#addTask">addTask</a></li><li><a href="global.html#addTasks">addTasks</a></li><li><a href="global.html#clearFilter">clearFilter</a></li><li><a href="global.html#connectedCallback">connectedCallback</a></li><li><a href="global.html#deleteEntries">deleteEntries</a></li><li><a href="global.html#deleteEntry">deleteEntry</a></li><li><a href="global.html#deleteLabel">deleteLabel</a></li><li><a href="global.html#deleteLabels">deleteLabels</a></li><li><a href="global.html#deleteTask">deleteTask</a></li><li><a href="global.html#deleteTasks">deleteTasks</a></li><li><a href="global.html#editEntry">editEntry</a></li><li><a href="global.html#editTask">editTask</a></li><li><a href="global.html#entriesRendererCallback">entriesRendererCallback</a></li><li><a href="global.html#factorial">factorial</a></li><li><a href="global.html#formatNote">formatNote</a></li><li><a href="global.html#getEntries">getEntries</a></li><li><a href="global.html#getFilteredEntries">getFilteredEntries</a></li><li><a href="global.html#getFilteredTasks">getFilteredTasks</a></li><li><a href="global.html#getJournalsFromStorage">getJournalsFromStorage</a></li><li><a href="global.html#getLabelColorMap">getLabelColorMap</a></li><li><a href="global.html#getLabels">getLabels</a></li><li><a href="global.html#getLabelsFromStorage">getLabelsFromStorage</a></li><li><a href="global.html#getTasks">getTasks</a></li><li><a href="global.html#getTasksConjunctLabels">getTasksConjunctLabels</a></li><li><a href="global.html#getTasksDisjunctLabels">getTasksDisjunctLabels</a></li><li><a href="global.html#getTasksFromStorage">getTasksFromStorage</a></li><li><a href="global.html#init">init</a></li><li><a href="global.html#onSubmit">onSubmit</a></li><li><a href="global.html#populateLabelDropdown">populateLabelDropdown</a></li><li><a href="global.html#populateLabels">populateLabels</a></li><li><a href="global.html#populateSelectedLabels">populateSelectedLabels</a></li><li><a href="global.html#randomColor">randomColor</a></li><li><a href="global.html#removeLabel">removeLabel</a></li><li><a href="global.html#saveJournalsToStorage">saveJournalsToStorage</a></li><li><a href="global.html#saveLabelColors">saveLabelColors</a></li><li><a href="global.html#saveTasksToStorage">saveTasksToStorage</a></li><li><a href="global.html#selectLabel">selectLabel</a></li><li><a href="global.html#setColors">setColors</a></li><li><a href="global.html#setWeeklyView">setWeeklyView</a></li><li><a href="global.html#tasksRendererCallback">tasksRendererCallback</a></li><li><a href="global.html#testing">testing</a></li><li><a href="global.html#toggleSelection">toggleSelection</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.3</a> on Tue Jun 04 2024 04:37:38 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
